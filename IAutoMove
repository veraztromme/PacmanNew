public interface IAutoMove
{
    (int row, int col) NextMove(Game game, Ghost ghost);
}

public class GoalOrientedMove : IAutoMove
{

    public (int row, int col) NextMove(Game game, Ghost ghost)
    {
        var board = game.board;
        var pacman = game.pacman;
        var currentPosition = ghost.currentPosition;
        var lastPosition = ghost.lastPosition;

        var target = pacman.currentPosition;

       
        var possibleSteps = new List<(int row, int col)>
        {
            (0, 1),   
            (1, 0),   
            (0, -1), 
            (-1, 0)  
        };

        var validSteps = possibleSteps

        // KRAV #6:
        // 1: LINQs metod-syntax
        // 2: Vi använder LINQ för att filtrera ut ogilitiga steg
        // 3: Vi ville simplifiera algoritmen för hur ghost rör sig frammåt på brädet
            .Where(step =>
            {
                int newRow = currentPosition.row + step.row;
                int newCol = currentPosition.col + step.col;

                bool canMove = newRow >= 0 && newRow < board.Height &&
                               newCol >= 0 && newCol < board.Width &&
                               board.grid[newRow][newCol].canMove;

                if (lastPosition.HasValue)
                {
                    if (newRow == lastPosition.Value.row && newCol == lastPosition.Value.col)
                        canMove = false;
                }

                return canMove;
            }).ToList();

        if (validSteps.Count == 0)
            return (0, 0); 

        var bestStep = validSteps
            .OrderBy(step =>
            {
                int newRow = currentPosition.row + step.row;
                int newCol = currentPosition.col + step.col;
                int dx = newCol - target.col;
                int dy = newRow - target.row;
                return dx * dx + dy * dy;
            })
            .First();

    
        ghost.lastPosition = currentPosition;

        return bestStep;
    }
}

 public class RandomMove : IAutoMove
 {

     private Random random = new Random();

     public (int row, int col) NextMove(Game game, Ghost ghost)
     {
         var board = game.board;
         var currentPosition = ghost.currentPosition;

         var possibleSteps = new List<(int row, int col)>
     {
         (0, 1),   
         (1, 0),   
         (0, -1),  
         (-1, 0)   
     };

         var validSteps = possibleSteps
             .Where(step =>
             {
                 int newRow = currentPosition.row + step.row;
                 int newCol = currentPosition.col + step.col;
                 return newRow >= 0 && newRow < board.Height &&
                        newCol >= 0 && newCol < board.Width &&
                        board.grid[newRow][newCol].canMove;
             }).ToList();

         if (validSteps.Count == 0)
             return (0, 0);

         return validSteps[random.Next(validSteps.Count)];
     }


 }

public enum Mode
{
    Scared,
    NotScared
}
